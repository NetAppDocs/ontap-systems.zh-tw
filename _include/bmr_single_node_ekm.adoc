= 
:allow-uri-read: 


您可以使用 `boot_recovery -partner`搭配執行 ONTAP 9 。 16.0 及更新版本的 ASA R2 平台、從合作夥伴節點還原 ONTAP 映像（開機媒體還原）。

當您在該節點上開機且開機媒體毀損時、您會在 Loader 提示字元下看到下列訊息和開機程序：

....

Can't find primary boot device u0a.0
Can't find backup boot device u0a.1
ACPI RSDP Found at 0x777fe014


Starting AUTOBOOT press Ctrl-C to abort...
Could not load fat://boot0/X86_64/freebsd/image1/kernel:Device not found

ERROR: Error booting OS on: 'boot0' file: fat://boot0/X86_64/Linux/image1/vmlinuz (boot0,fat)


ERROR: Error booting OS on: 'boot0' file: fat://boot0/X86_64/freebsd/image1/kernel (boot0,fat)


Autoboot of PRIMARY image failed. Device not found (-6)
LOADER-A>
....
如果您看到此訊息、則必須還原 ONTAP 映像。

.步驟
. 在 Loader 提示字元中、輸入 _boot_recovery -PARTNER_ 命令。
+
畫面會顯示訊息 `Starting boot media recovery (BMR) process press Ctrl-C to abort...`、並開始初始檢查及安裝開機恢復檔案。

+
.. 如果已設定外部金鑰管理程式（ EKM ）、您將會看到下列顯示：
+
....
Error when fetching key manager config from partner 169.254.139.209: 28
Has key manager been configured on this system? {y|n}
....
.. 如果已設定金鑰管理員、請輸入 _y_ 。
+
....
key manager is configured.
Entering Bootmenu Option 11...
....


+
Bootmenu Option 11 會提示使用者輸入所有的 EKM 組態資訊、以便重新建立組態檔案。

. 在每個提示時輸入 EKM 配置。
+
* 附註： * 大部分資訊是在最初啟用 EKM 時輸入。您應該輸入與初始 EKM 組態期間相同的資訊。

. 檢查 `Keystore UUID`和 `Cluster UUID`是否正確。
+
.. 在合作夥伴節點上、使用 `cluster identity show`命令擷取叢集 UUID 。
.. 在合作夥伴節點上、使用 `vserver show -type admin` `key-manager keystore show -vserver <nodename>`命令和命令擷取 Keystore UUID 。
.. 出現提示時、請輸入 Keystore UUID 和叢集 UUID 的值。
+
* 注意： * 如果合作夥伴節點無法使用、則可從設定金鑰伺服器上的 Mroot-AK 金鑰取得 Keystore UUID 和叢集 UUID 。

+
驗證 `x-NETAPP-ClusterName: <cluster name>`叢集 UUID 和 `x-NETAPP-KeyUsage: "MROOT-AK"` Keystore UUID 屬性的、以確保您擁有正確的金鑰。



. 監控將 Mroot-AK 擷取及還原至 ONTAP 節點。
. 如果程序無法還原金鑰、您會看到下列訊息、需要從功能表系統 Shell 設定 e0M ：
+
....
ERROR: kmip_init: halting this system with encrypted mroot...
WARNING: kmip_init: authentication keys might not be available.
********************************************************
*                 A T T E N T I O N                    *
*                                                      *
*       System cannot connect to key managers.         *
*                                                      *
********************************************************
ERROR: kmip_init: halting this system with encrypted mroot...
.
Terminated

Uptime: 11m32s
System halting...

LOADER-B>

....
+
..  `boot_recovery -partner`在恢復節點上運行命令。
.. 當系統提示您執行（ y 或 n ） EKM 選項時、請為所有選項選取 _n_ 。
+
為 8 個提示選取 _n_ 選項後、系統將會在開機功能表停止。

.. 從其他叢集節點收集 /ccfcard/kmip/servers.cfg 檔案資訊。您將收集下列資訊：
+
*** KMIP 伺服器位址。
*** KMIP 連接埠。
*** Keystore UUID 。
*** 從 /ccfcard/kmip/certs/client.crt 檔案複本用戶端憑證。
*** 從 /ccfcard/kmip/certs/client.key 檔案複本用戶端金鑰。
*** 從 /ccfcard/kmip/certs/ca.pem 檔案複本 KMIP 伺服器 CA 。


.. 在提示字元輸入 _systemshell_ 、從開機功能表進入 systemshell 。
.. 從系統殼層功能表設定網路、用於 e0M 、網路遮罩和閘道。
.. 使用 _exit_ 命令從功能表系統 Shell 結束。
.. 您會看到開機功能表。選取選項 `11`以繼續 EKM 還原。
.. 回答 `y`下列問題、並在出現提示時輸入您先前收集的必要資訊：
+
*** 您是否有 /ccfcard/kmip/certs/client.crt 檔案的複本？｛ y/n ｝
*** 您是否擁有 /ccfcard/kmip/certs/client.key 檔案的複本？｛ y/n ｝
*** 您是否擁有 /ccfcard/kmip/certs/ca.pem 檔案的複本？｛ y/n ｝
*** 您是否有 /ccfcard/kmip/servers.cfg 檔案的複本？｛ y/n ｝




. 如果金鑰已正確還原、則恢復程序會繼續並重新啟動節點。

