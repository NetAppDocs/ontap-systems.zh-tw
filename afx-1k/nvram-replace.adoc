---
permalink: afx-1k/nvram-replace.html 
sidebar: sidebar 
keywords: afx 1k, replace nvram 
summary: 當非揮發性記憶體故障或需要升級時，請更換 AFX 1K 儲存系統中的NVRAM 。 
---
= 更換NVRAM - AFX 1K
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
當非揮發性記憶體故障或需要升級時，請更換 AFX 1K 儲存系統中的NVRAM 。更換過程包括關閉受損的控制器、更換NVRAM模組或NVRAM DIMM，以及將故障零件退回給NetApp。

NVRAM 模組包含 NVRAM12 硬體和現場可更換的 DIMM 。您可以更換故障的NVRAM模組或NVRAM模組內的DIMM。

.開始之前
* 請確定您有可用的替換零件。您必須使用從 NetApp 收到的替換元件來更換故障的元件。
* 確保儲存系統中的所有其他元件正常運作；如果沒有，請聯絡 https://support.netapp.com["NetApp支援"]。




== 步驟1：關閉受損的控制器

關閉或接管受損的控制器。

要關閉受損控制器，您必須確定控制器的狀態，並在必要時執行控制器的儲存故障轉移接管，以便健康的控制器繼續從受損控制器儲存提供資料。

.關於這項工作
* 如果您的叢集具有四個以上的節點，則它必須達到法定人數。要查看有關節點的叢集信息，請使用 `cluster show`命令。有關 `cluster show`命令，請參閱link:https://docs.netapp.com/us-en/ontap/system-admin/display-nodes-cluster-task.html["查看ONTAP叢集中的節點級詳細信息"^]。
* 如果叢集不處於法定人數，或任何控制器（受損控制器除外）的健康狀況或資格顯示為錯誤，則必須在關閉受損控制器之前修正該問題。看link:https://docs.netapp.com/us-en/ontap/system-admin/synchronize-node-cluster-task.html?q=Quorum["將節點與叢集同步"^] 。


.步驟
. 如果啟用了「支援」功能、請叫用下列消息來禁止自動建立個案AutoSupport AutoSupport ：
+
`system node autosupport invoke -node * -type all -message MAINT=<# of hours>h`

+
下列AutoSupport 資訊不顯示自動建立案例兩小時：

+
`cluster1:> system node autosupport invoke -node * -type all -message MAINT=2h`

. 從受損控制器的控制台停用自動交還：
+
`storage failover modify -node impaired-node -auto-giveback-of false`

+

NOTE: 當您看到「您想要停用自動回饋嗎？」時，請輸入 `y`。

+
.. 如果您執行的是ONTAP版本 9.17.1，且受損控制器無法啟動或已被接管，則必須在啟動受損控制器之前從正常控制器上斷開 HA 互連鏈路。這可以防止受損控制器執行自動交還。
+
`system ha interconnect link off -node healthy-node -link 0`

+
`system ha interconnect link off -node healthy-node -link 1`

+

NOTE: 如果您執行的不是ONTAP版本 9.17.1，請跳過上述步驟並前往步驟 3。



. 將受損的控制器移至載入器提示：
+
[cols="1,2"]
|===
| 如果受損的控制器正在顯示... | 然後... 


 a| 
載入程式提示
 a| 
前往下一步。



 a| 
系統提示或密碼提示
 a| 
從健康控制器接管或停止受損控制器：
`storage failover takeover -ofnode _impaired_node_name_ -halt _true_`

_-halt true_ 參數將受損節點帶入 LOADER 提示符。

|===




== 步驟 2 ：更換 NVRAM 模組或 NVRAM DIMM

使用下列適當選項更換 NVRAM 模組或 NVRAM DIMM 。

[role="tabbed-block"]
====
.選項 1 ：更換 NVRAM 模組
--
若要更換 NVRAM 模組、請將其置於機箱的插槽 4/5 中、然後依照特定步驟順序進行。

. 如果您尚未接地、請正確接地。
. 從控制器上拔下 PSU 的電源線。
. 輕輕拉動托盤兩端的插針、然後向下旋轉托盤、將纜線管理托盤向下旋轉。
. 從機箱中卸下受損的 NVRAM 模組：
+
.. 按下鎖定凸輪按鈕。
+
CAM 按鈕會移出機箱。

.. 向下轉動凸輪栓鎖、直到卡入定位為止。
.. 將手指插入 CAM 拉桿開口處、然後將模組拉出機箱、即可將受損的 NVRAM 模組從機箱中移除。
+
image::../media/drw_a1k_nvram12_remove_replace_ieops-1380.svg[取下 NVRAM12 模組和 DIMM]

+
[cols="1,4"]
|===


 a| 
image:../media/icon_round_1.png["編號 1"]
| CAM 鎖定按鈕 


 a| 
image:../media/icon_round_2.png["編號 2"]
 a| 
DIMM 鎖定彈片

|===


. 將 NVRAM 模組放置在穩固的表面上。
. 從受損的 NVRAM 模組中逐一移除 DIMM 、然後將其安裝在替換的 NVRAM 模組中。
. 將替換的 NVRAM 模組安裝到機箱中：
+
.. 將模組與插槽 4/5 中機箱開口的邊緣對齊。
.. 將模組一路輕輕滑入插槽、然後將 CAM 栓鎖完全向上旋轉、將模組鎖定到位。


. 將纜線管理承載器向上旋轉至關閉位置。


--
.選項 2 ：更換 NVRAM DIMM
--
若要更換 NVRAM 模組中的 NVRAM DIMM 、您必須先移除 NVRAM 模組、然後更換目標 DIMM 。

. 如果您尚未接地、請正確接地。
. 從 PSU 上拔下電源線。
. 輕輕拉動托盤兩端的插針、然後向下旋轉托盤、將纜線管理托盤向下旋轉。
. 從機箱中卸下目標 NVRAM 模組。
+
image::../media/drw_a1k_nvram12_remove_replace_ieops-1380.svg[卸下 NVRAM 12 模組和 DIMM]

+
[cols="1,4"]
|===


 a| 
image:../media/icon_round_1.png["編號 1"]
| CAM 鎖定按鈕 


 a| 
image:../media/icon_round_2.png["編號 2"]
 a| 
DIMM 鎖定彈片

|===
. 將 NVRAM 模組放置在穩固的表面上。
. 找到 NVRAM 模組內要更換的 DIMM 。
+

NOTE: 請參閱 NVRAM 模組側邊的 FRU 對應標籤、以判斷 DIMM 插槽 1 和 2 的位置。

. 按下 DIMM 鎖定彈片並將 DIMM 從插槽中取出、以卸下 DIMM 。
. 將DIMM對齊插槽、然後將DIMM輕推入插槽、直到鎖定彈片鎖定到位、即可安裝替換DIMM。
. 將 NVRAM 模組安裝至機箱：
+
.. 將模組輕輕滑入插槽、直到凸輪閂鎖開始與 I/O 凸輪銷接合、然後將凸輪閂鎖完全向上旋轉、將模組鎖定到位。


. 將纜線管理承載器向上旋轉至關閉位置。


--
====


== 步驟 3 ：重新啟動控制器

更換FRU之後、您必須重新啟動控制器模組。

. 將電源線重新插入 PSU。
+
系統將開始重新開機、通常會進入載入程式提示。

. 進入 `bye`在 LOADER 提示符號下。




== 步驟 4：完成NVRAM替換

執行以下步驟以完成NVRAM替換。

.步驟
. 在控制器的載入器提示字元中、啟動控制器、並在系統 ID 不相符而提示覆寫系統 ID 時輸入 _y_ 。
+
以下是覆蓋系統 ID 的提示範例：

+
[listing]
----
WARNING: System ID mismatch. This usually occurs when replacing a boot device or NVRAM cards!
Override system ID? {y|n}
----
. 從健康的控制器，驗證新的合作夥伴系統 ID 是否已自動分配：
`_storage failover show_`
+
在命令輸出中，您應該會看到一條顯示儲存替換當前狀態的訊息。在以下範例中，node2 已完成替換，並顯示目前狀態為「接管中」。

+
[listing]
----
node1:> storage failover show
                                    Takeover
Node              Partner           Possible     State Description
------------      ------------      --------     -------------------------------------
node1             node2             false        In takeover
node2             node1             -            Waiting for giveback
----
. 退回控制器：
+
.. 從健康的控制器中歸還被替換控制器的儲存：`_storage failover giveback -ofnode replacement_node_name_`
+
控制器會恢復其儲存設備並完成開機。

+

NOTE: 如果被否決、您可以考慮覆寫否決。

+
如需詳細資訊、請參閱 https://docs.netapp.com/us-en/ontap/high-availability/ha_manual_giveback.html#if-giveback-is-interrupted["手動恢復命令"^] 取代否決的主題。

.. 完成恢復後、確認 HA 配對是否正常、而且可以接管： _storage 容錯移轉 show_
+
「儲存容錯移轉show」命令的輸出不應包含在合作夥伴訊息中變更的系統ID。



. 驗證每個控制器是否存在預期的磁碟區：
+
`vol show -node node-name`

. 主控台訊息停止時、按 <enter> 。
+
** 如果您看到_login_提示，請前往下一個步驟。
** 如果您沒有看到登入提示，請登入合作夥伴節點。


. 在恢復報告完成後等待 5 分鐘，並檢查容錯移轉狀態和恢復狀態：
+
`storage failover show`和 `storage failover show-giveback`

+

NOTE: 以下命令僅在診斷模式權限等級下可用。

. 如果 HA 互連鏈路已斷開，請將其恢復：
+
`system ha interconnect link on -node healthy-node -link 0`

+
`system ha interconnect link on -node healthy-node -link 1`

. 將受損的控制器歸還其儲存設備、使其恢復正常運作：
+
'容錯移轉還原-ofnode_disapped_node_name_'

. 如果自動恢復已停用、請重新啟用：
+
`storage failover modify -node local -auto-giveback-of true`

. 如果啟用 AutoSupport ，則還原 / 恢復自動建立個案：
+
`system node autosupport invoke -node * -type all -message MAINT=END`





== 步驟5：將故障零件歸還給NetApp

如套件隨附的RMA指示所述、將故障零件退回NetApp。如 https://mysupport.netapp.com/site/info/rma["零件退貨與更換"]需詳細資訊、請參閱頁面。
