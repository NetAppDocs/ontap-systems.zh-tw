---
permalink: a70-90/nvram-replace.html 
sidebar: sidebar 
keywords: aff a70, aff a90, replace an nvram 
summary: 當非揮發性記憶體故障或需要升級時，請更換 AFF A70 或 AFF A90 系統中的 NVRAM 。 
---
= 更換 NVRAM - AFF A70 and AFF A90
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
當非揮發性記憶體故障或需要升級時，請更換AFF A70或AFF A90系統中的NVRAM 。更換過程包括關閉受損的控制器、將控制器拉出幾英寸以完全切斷電源、更換NVRAM模組或NVRAM DIMM、重新分配磁碟，以及將故障部件返回給NetApp。

NVRAM 模組包含 NVRAM12 硬體和現場可更換的 DIMM 。您可以更換故障的NVRAM模組或NVRAM模組內的DIMM。

.開始之前
* 請確定您有可用的替換零件。您必須使用從 NetApp 收到的替換元件來更換故障的元件。
* 確保儲存系統中的所有其他元件正常運作；如果沒有，請聯絡 https://support.netapp.com["NetApp支援"]。




== 步驟1：關閉受損的控制器

使用下列其中一個選項來關閉或接管受損的控制器。

[role="tabbed-block"]
====
.選項1：大多數系統
--
若要關閉受損的控制器、您必須判斷控制器的狀態、並在必要時接管控制器、以便健全的控制器繼續從受損的控制器儲存設備提供資料。

.關於這項工作
* 如果您有 SAN 系統，則必須檢查故障控制器 SCSI 刀鋒的事件訊息  `cluster kernel-service show`。 `cluster kernel-service show`命令（從 priv 進階模式）會顯示節點名稱、link:https://docs.netapp.com/us-en/ontap/system-admin/display-nodes-cluster-task.html["仲裁狀態"]該節點的可用度狀態、以及該節點的作業狀態。
+
每個SCSI刀鋒處理序都應與叢集中的其他節點處於仲裁狀態。任何問題都必須先解決、才能繼續進行更換。

* 如果叢集有兩個以上的節點、則叢集必須處於仲裁狀態。如果叢集未達到法定人數、或健全的控制器顯示為「假」、表示符合資格和健全狀況、則您必須在關閉受損的控制器之前修正問題；請參閱 link:https://docs.netapp.com/us-en/ontap/system-admin/synchronize-node-cluster-task.html?q=Quorum["將節點與叢集同步"^]。


.步驟
. 如果啟用了「支援」功能、請叫用下列消息來禁止自動建立個案AutoSupport AutoSupport ：
+
`system node autosupport invoke -node * -type all -message MAINT=<# of hours>h`

+
下列AutoSupport 資訊不顯示自動建立案例兩小時：

+
`cluster1:> system node autosupport invoke -node * -type all -message MAINT=2h`

. 停用自動交還：
+
.. 從健康控制器的控制台輸入以下命令：
+
`storage failover modify -node _impaired_node_name_ -auto-giveback false`

.. 進入 `y`當您看到提示「您是否要停用自動回饋？」時


. 將受損的控制器移至載入器提示：
+
[cols="1,2"]
|===
| 如果受損的控制器正在顯示... | 然後... 


 a| 
載入程式提示
 a| 
前往下一步。



 a| 
正在等待恢復...
 a| 
按Ctrl-C、然後在出現提示時回應「y」。



 a| 
系統提示或密碼提示
 a| 
從健全的控制器接管或停止受損的控制器：

`storage failover takeover -ofnode _impaired_node_name_ -halt _true_`

--halt true_ 參數會帶您進入 Loader 提示字元。

|===


--
.選項2：控制器位於MetroCluster 一個不二之處
--
若要關閉受損的控制器、您必須判斷控制器的狀態、並在必要時接管控制器、以便健全的控制器繼續從受損的控制器儲存設備提供資料。

* 如果叢集有兩個以上的節點、則叢集必須處於仲裁狀態。如果叢集未達到法定人數、或健全的控制器顯示為「假」、表示符合資格和健全狀況、則您必須在關閉受損的控制器之前修正問題；請參閱 link:https://docs.netapp.com/us-en/ontap/system-admin/synchronize-node-cluster-task.html?q=Quorum["將節點與叢集同步"^]。
* 您必須確認已設定 MetroCluster 組態狀態，且節點處於啟用和正常狀態：
+
`metrocluster node show`



.步驟
. 如果啟用了「支援」功能、請叫用下列消息來禁止自動建立個案AutoSupport AutoSupport ：
+
`system node autosupport invoke -node * -type all -message MAINT=number_of_hours_downh`

+
下列AutoSupport 資訊不顯示自動建立案例兩小時：

+
`cluster1:*> system node autosupport invoke -node * -type all -message MAINT=2h`

. 停用自動交還：
+
.. 從健康控制器的控制台輸入以下命令：
+
`storage failover modify -node local -auto-giveback false`

.. 進入 `y`當您看到提示「您是否要停用自動回饋？」時


. 將受損的控制器移至載入器提示：
+
[cols="1,2"]
|===
| 如果受損的控制器正在顯示... | 然後... 


 a| 
載入程式提示
 a| 
前往下一節。



 a| 
正在等待恢復...
 a| 
按Ctrl-C、然後在出現提示時回應「y」。



 a| 
系統提示或密碼提示（輸入系統密碼）
 a| 
從健全的控制器接管或停止受損的控制器：

`storage failover takeover -ofnode _impaired_node_name_ -halt _true_`

--halt true_ 參數會帶您進入 Loader 提示字元。

|===


--
====


== 步驟 2 ：更換 NVRAM 模組或 NVRAM DIMM

使用適當的選項更換NVRAM模組或NVRAM DIMM。


CAUTION: 在安裝和維護過程中，請務必配戴連接至已驗證接地點的接地腕帶。未採取正確的 ESD 防護措施可能會對控制器節點、儲存架和網路交換器造成永久性損壞。

[role="tabbed-block"]
====
.選項 1 ：更換 NVRAM 模組
--
若要更換 NVRAM 模組、請將其放在機箱的插槽 4/5 中、然後依照特定步驟順序進行。

. 請用拇指推動每個磁碟機，直到您感覺到正向停止為止，以確保機箱中的所有磁碟機都穩固地安裝在中間背板上。
+
.影片 - 確認駕駛座椅
video::2c46e4af-2c21-4f12-b065-b38b003d0ea2[panopto]
+
image::../media/drw_a800_drive_seated_IEOPS-960.svg[將驅動器安裝到位]

. 根據系統狀態檢查控制器驅動器：
+
.. 在運作正常的控制器上，檢查是否有任何處於降級狀態、故障狀態或兩者兼具的狀態：
+
[source, cli]
----
storage aggregate show -raidstatus !*normal*
----
+
*** 如果命令返回 `There are no entries matching your query.`繼續<<Check-missing-drives,進入下一個子步驟，檢查是否有缺少的驅動器。>>。
*** 如果該命令返回任何其他結果，請從兩個控制器收集AutoSupport數據，並聯絡NetApp支援部門以取得進一步協助。
+
[source, cli]
----
system node autosupport invoke -node * -type all -message '<message_name>'
----


.. [[檢查缺少磁碟機]]檢查檔案系統或備用磁碟機是否有缺失磁碟機問題：
+
[source, cli]
----
event log show -severity * -node * -message-name *disk.missing*
----
+
*** 如果命令返回 `There are no entries matching your query.`繼續<<Go-to-the-rear,進入下一步>>。
*** 如果該命令返回任何其他結果，請從兩個控制器收集AutoSupport數據，並聯絡NetApp支援部門以取得進一步協助。
+
[source, cli]
----
system node autosupport invoke -node * -type all -message '<message_name>'
----




. [[前往後方]]前往底盤後方。
. 拔下控制器的 PSU。
+

NOTE: 如果您的系統有直流電源、請從 PSU 拔下電源區塊。

. 按下控制器上的兩個鎖定閂鎖，同時向下旋轉兩個閂鎖，然後將控制器拉出約 3 或 4 英吋。
. 向下轉動纜線管理托盤、方法是拉動纜線管理托盤內部的按鈕、然後向下旋轉。
. 從機箱中移除目標NVRAM模組：
+
.. 按下 CAM LATCH 按鈕。
+
CAM按鈕會從機箱移出。

.. 轉動凸輪栓鎖至最遠位置。
.. 將手指插入 CAM 拉桿開口處、然後將模組拉出機箱、即可將受損的 NVRAM 模組從機箱中移除。
+
image::../media/drw_a70-90_nvram12_remove_replace_ieops-1370.svg[取下 NVRAM12 模組和 DIMM]

+
[cols="1,4"]
|===


 a| 
image:../media/icon_round_1.png["編號 1"]
 a| 
CAM 鎖定按鈕



 a| 
image:../media/icon_round_2.png["編號 2"]
 a| 
DIMM 鎖定彈片

|===


. 將 NVRAM 模組放置在穩固的表面上。
. 從受損的 NVRAM 模組中逐一移除 DIMM 、然後將其安裝在替換的 NVRAM 模組中。
. 將替換的NVRAM模組安裝到機箱：
+
.. 將模組與插槽 4/5 中機箱開口的邊緣對齊。
.. 將模組一路輕輕滑入插槽、然後將 CAM 栓鎖往上推、將模組鎖定到位。


. 重新安裝控制器模組。控制器完全插入後立即重新啟動。
+
.. 將控制器模組穩固地推入機箱、直到它與中間板完全接入。
+
控制器模組完全就位時、鎖定鎖條會上升。

+

NOTE: 將控制器模組滑入機箱時、請勿過度施力、以免損壞連接器。

.. 將鎖定閂向上旋轉至鎖定位置。


. 將電源線插入電源供應器。
+

NOTE: 如果您有直流電源，請將電源塊重新連接到電源。

. 將纜線管理承載器向上旋轉至關閉位置。
. 將功能受損的控制器恢復正常運作，只需歸還其儲存設備 `storage failover giveback -ofnode _impaired_node_name_`：。
. 如果已停用自動恢復功能、請重新啟用： `storage failover modify -node local -auto-giveback true`。
. 如果啟用 AutoSupport 、則還原 / 恢復自動建立個案： `system node autosupport invoke -node * -type all -message MAINT=END`。


--
.選項 2 ：更換 NVRAM DIMM
--
若要更換 NVRAM 模組中的 NVRAM DIMM ，必須先卸下 NVRAM 模組，然後更換目標 DIMM 。

. 如果您尚未接地、請正確接地。
. 請用拇指推動每個磁碟機，直到您感覺到正向停止為止，以確保機箱中的所有磁碟機都穩固地安裝在中間背板上。
+
.影片 - 確認駕駛座椅
video::2c46e4af-2c21-4f12-b065-b38b003d0ea2[panopto]
+
image::../media/drw_a800_drive_seated_IEOPS-960.svg[將驅動器安裝到位]

. 根據系統狀態檢查控制器驅動器：
+
.. 在運作正常的控制器上，檢查是否有任何處於降級狀態、故障狀態或兩者兼具的狀態：
+
[source, cli]
----
storage aggregate show -raidstatus !*normal*
----
+
*** 如果命令返回 `There are no entries matching your query.`繼續<<Check-missing-drives,進入下一個子步驟，檢查是否有缺少的驅動器。>>。
*** 如果該命令返回任何其他結果，請從兩個控制器收集AutoSupport數據，並聯絡NetApp支援部門以取得進一步協助。
+
[source, cli]
----
system node autosupport invoke -node * -type all -message '<message_name>'
----


.. [[檢查缺少磁碟機]]檢查檔案系統或備用磁碟機是否有缺失磁碟機問題：
+
[source, cli]
----
event log show -severity * -node * -message-name *disk.missing*
----
+
*** 如果命令返回 `There are no entries matching your query.`繼續<<Go-to-the-rear,進入下一步>>。
*** 如果該命令返回任何其他結果，請從兩個控制器收集AutoSupport數據，並聯絡NetApp支援部門以取得進一步協助。
+
[source, cli]
----
system node autosupport invoke -node * -type all -message '<message_name>'
----




. [[前往後方]]前往底盤後方。
. 拔下控制器的 PSU。
+

NOTE: 如果您的系統有直流電源、請從 PSU 拔下電源區塊。

. 按下控制器上的兩個鎖定閂鎖，同時向下旋轉兩個閂鎖，然後將控制器拉出約 3 或 4 英吋。
. 輕輕拉動托盤兩端的插針、然後向下旋轉托盤、將纜線管理托盤向下旋轉。
. 從機箱中移除目標NVRAM模組：
+
.. 按下 CAM 按鈕。
+
CAM按鈕會從機箱移出。

.. 轉動凸輪栓鎖至最遠位置。
.. 將手指插入 CAM 拉桿開口處、然後將模組拉出機箱、即可從機箱中移除 NVRAM 模組。
+
image::../media/drw_a70-90_nvram12_remove_replace_ieops-1370.svg[取下 NVRAM12 模組和 DIMM]

+
[cols="1,4"]
|===


 a| 
image:../media/icon_round_1.png["編號 1"]
| CAM 鎖定按鈕 


 a| 
image:../media/icon_round_2.png["編號 2"]
 a| 
DIMM 鎖定彈片

|===


. 將 NVRAM 模組放置在穩固的表面上。
. 找到 NVRAM 模組內要更換的 DIMM 。
+

NOTE: 請參閱 NVRAM 模組側邊的 FRU 對應標籤、以判斷 DIMM 插槽 1 和 2 的位置。

. 按下 DIMM 鎖定彈片並將 DIMM 從插槽中取出、以卸下 DIMM 。
. 將DIMM對齊插槽、然後將DIMM輕推入插槽、直到鎖定彈片鎖定到位、即可安裝替換DIMM。
. 將NVRAM模組安裝至機箱：
+
.. 將模組輕輕滑入插槽、直到凸輪閂鎖開始與 I/O 凸輪銷接合、然後將凸輪閂鎖完全向上旋轉、將模組鎖定到位。


. 重新安裝控制器模組。控制器完全插入後立即重新啟動。
+
.. 將控制器模組穩固地推入機箱、直到它與中間板完全接入。
+
控制器模組完全就位時、鎖定鎖條會上升。

+

NOTE: 將控制器模組滑入機箱時、請勿過度施力、以免損壞連接器。

.. 將鎖定閂向上旋轉至鎖定位置。


. 將電源線插入電源供應器。
+

NOTE: 如果您有直流電源，請將電源塊重新連接到電源。

. 將纜線管理承載器向上旋轉至關閉位置。
. 將功能受損的控制器恢復正常運作，只需歸還其儲存設備 `storage failover giveback -ofnode _impaired_node_name_`：。
. 如果已停用自動恢復功能、請重新啟用： `storage failover modify -node local -auto-giveback true`。
. 如果啟用 AutoSupport 、則還原 / 恢復自動建立個案： `system node autosupport invoke -node * -type all -message MAINT=END`。


--
====


== 步驟3：重新指派磁碟

您必須在開機控制器時確認系統 ID 變更、然後確認變更已實作。


CAUTION: 只有在更換 NVRAM 模組時才需要重新指派磁碟、而且不適用於 NVRAM DIMM 更換。

.步驟
. 如果控制器處於維護模式（顯示 `*>`提示符號），退出維護模式並進入 LOADER 提示符號：
+
`halt`

. 在控制器的載入器提示字元中、啟動控制器、並在系統 ID 不相符而提示覆寫系統 ID 時輸入 _y_ 。
. 等到更換模組的控制器控制台上顯示等待交還訊息，然後從健康的控制器驗證是否已自動指派新的合作夥伴系統 ID：
+
`storage failover show`

+
在命令輸出中，您應該會看到一則訊息，表示受損控制器上的系統 ID 已更改，並顯示正確的舊 ID 和新 ID。在下列範例中，節點 2 已完成替換，並具有新的系統 ID 151759706。

+
[listing]
----
node1:> storage failover show
                                    Takeover
Node              Partner           Possible     State Description
------------      ------------      --------     -------------------------------------
node1             node2             false        System ID changed on partner (Old:
                                                  151759755, New: 151759706), In takeover
node2             node1             -            Waiting for giveback (HA mailboxes)
----
. 退回控制器：
+
.. 從健康的控制器中，歸還被替換的控制器的儲存空間：+
`storage failover giveback -ofnode replacement_node_name`
+
控制器會恢復其儲存設備並完成開機。

+
如果系統因為系統 ID 不相符而提示您置換系統 ID 、您應該輸入 _y_ 。

+
如果被否決、您可以考慮覆寫否決。

+
有關詳細信息，請參閱 https://docs.netapp.com/us-en/ontap/high-availability/ha_manual_giveback.html#if-giveback-is-interrupted["手動交還命令"^]推翻否決。

.. 完成恢復後、確認 HA 配對是否正常、而且可以接管： _storage 容錯移轉 show_
+
「儲存容錯移轉show」命令的輸出不應包含在合作夥伴訊息中變更的系統ID。



. 驗證磁碟是否已正確分配：
+
`storage disk show -ownership`

+
屬於控制器的磁碟應顯示新的系統 ID 。在下列範例中、node1擁有的磁碟現在顯示新的系統ID：151759706：

+
[listing]
----
node1:> storage disk show -ownership

Disk  Aggregate Home  Owner  DR Home  Home ID    Owner ID  DR Home ID Reserver  Pool
----- ------    ----- ------ -------- -------    -------    -------  ---------  ---
1.0.0  aggr0_1  node1 node1  -        151759706  151759706  -       151759706 Pool0
1.0.1  aggr0_1  node1 node1           151759706  151759706  -       151759706 Pool0
.
.
.
----
. 如果系統為 MetroCluster 組態、請監控控制器的狀態： MetroCluster 節點 show_
+
更換後、需要幾分鐘時間才能恢復正常狀態、此時每個控制器都會顯示已設定的狀態、並啟用DR鏡射和正常模式。MetroCluster「停止節點show -Fields node-SystemID」命令輸出會顯示舊的系統ID、直到該組態恢復正常狀態為止。MetroCluster MetroCluster

. 如果控制器是MetroCluster 以支援功能為基礎的組態、請MetroCluster 視所用的情況而定、確認如果原始擁有者是災難站台上的控制器、DR主ID欄位會顯示磁碟的原始擁有者。
+
如果下列兩項條件均為真、則必須執行此動作：

+
** 此功能組態處於切換狀態。MetroCluster
** 控制器是災難站台上磁碟的目前擁有者。
+
請參閱 https://docs.netapp.com/us-en/ontap-metrocluster/manage/concept_understanding_mcc_data_protection_and_disaster_recovery.html#disk-ownership-changes-during-ha-takeover-and-metrocluster-switchover-in-a-four-node-metrocluster-configuration["在HA接管期間、磁碟擁有權會有所變更、MetroCluster 而在四節點MetroCluster 的功能組態中、也會進行不全的功能切換"] 以取得更多資訊。



. 如果您的系統是 MetroCluster 組態、請確認每個控制器都已設定： MetroCluster 節點顯示 - 欄位組態狀態 _
+
[listing]
----
node1_siteA::> metrocluster node show -fields configuration-state

dr-group-id            cluster node           configuration-state
-----------            ---------------------- -------------- -------------------
1 node1_siteA          node1mcc-001           configured
1 node1_siteA          node1mcc-002           configured
1 node1_siteB          node1mcc-003           configured
1 node1_siteB          node1mcc-004           configured

4 entries were displayed.
----
. 驗證每個控制器是否存在預期的磁碟區：
+
`vol show -node node-name`

. 如果已啟用儲存加密、則必須還原功能。
. 將受損的控制器歸還其儲存設備、使其恢復正常運作：
+
`storage failover giveback -ofnode _impaired_node_name_`。

. 如果自動恢復已停用、請重新啟用：
+
`storage failover modify -node local -auto-giveback true`。

. 如果啟用 AutoSupport ，則還原 / 恢復自動建立個案：
+
`system node autosupport invoke -node * -type all -message MAINT=END`。





== 步驟4：將故障零件歸還給NetApp

如套件隨附的RMA指示所述、將故障零件退回NetApp。如 https://mysupport.netapp.com/site/info/rma["零件退貨與更換"]需詳細資訊、請參閱頁面。
