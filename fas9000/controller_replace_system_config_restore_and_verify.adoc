---
permalink: fas9000/controller-replace-system-config-restore-and-verify.html 
sidebar: sidebar 
keywords: aff a700, fas9000, verify, ha, state, controller, module, system, diagnostics 
summary: 完成硬體更換並開機至維護模式之後、您需要驗證更換控制器的低階系統組態、並視需要重新設定系統設定。 
---
= 還原並驗證系統組態：AFF Ar主機 架上的架構
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
完成硬體更換並開機至維護模式之後、您需要驗證更換控制器的低階系統組態、並視需要重新設定系統設定。



== 步驟1：更換控制器後、請設定並驗證系統時間

您應該對照HA配對中的健全控制器模組、或獨立組態中的可靠時間伺服器、檢查更換控制器模組的時間和日期。如果時間和日期不相符、您必須在更換的控制器模組上重設、以避免客戶端因時間差異而可能發生中斷。

請務必在正確的系統上套用步驟中的命令：

* _replaced_節點是新的節點、在本程序中會取代受損節點。
* _Healthy節點是_replace_節點的HA合作夥伴。


.步驟
. 如果_replacem__節點未出現在載入程式提示字元、請停止系統並顯示載入程式提示字元。
. 在_Healthy節點上、檢查系統時間：「How date（顯示日期）」
+
日期與時間以GMT.為準。

. 在載入程式提示下、檢查_replacement節點上的日期和時間：「How date（顯示日期）」
+
日期與時間以GMT.為準。

. 如有必要、請在替換節點上設定以GMT0為單位的日期：「et date _mm/dd/ymm_'（設定日期_月/日/西元年_）」
. 如有必要、請在替換節點上設定以GMT0為單位的時間：「et time _hh：mm:ss_」（設定時間_hh：mm：ss_）
. 在載入程式提示下、確認_replaced_節點上的日期和時間：「How date（顯示日期）」
+
日期與時間以GMT.為準。





== 步驟2：驗證並設定控制器模組的HA狀態

您必須驗證控制器模組的「HA」狀態、並視需要更新狀態以符合您的系統組態。

.步驟
. 在新控制器模組的維護模式中、確認所有元件都顯示相同的「HA」狀態：「ha-config show」
+
HA狀態的值可以是下列其中一項：

+
** 《哈》
** "Malc"
** 「抄送給我們」
** 《MCCIP》
** 「非哈」
+
... 確認設定已變更：「ha-config show」








== 步驟3：執行系統層級診斷

[role="lead"]
您應該在更換控制器時、針對特定元件和子系統執行全方位或集中的診斷測試。

診斷程序中的所有命令都會從要更換元件的節點發出。

.步驟
. 如果要服務的節點不在載入程式提示下、請重新啟動節點：「halt」
+
發出命令之後、您應該等到系統在載入程式提示字元停止。

. 在載入程式提示字元下、存取專為系統層級診斷所設計的特殊驅動程式、以正常運作：「boot_diags'（boot_diags'）
+
在開機過程中、您可以安全地回應提示「y」、直到出現「維護模式」提示（*>）為止。

. 顯示並記下控制器模組上的可用裝置：「ldiag設備show -devMB」
+
顯示的控制器模組裝置和連接埠可以是下列任一或多個項目：

+
** 「bootmedia」是系統開機裝置。
** 「cna」是整合式網路介面卡、或是未連線至網路或儲存設備的介面。
** 「FCAL」是光纖通道仲裁的迴圈裝置、未連接至光纖通道網路。
** 「env」是主機板環境。
** 「我」是系統記憶體。
** 「NIC」是一種網路介面卡。
** NVRAM是非易失性RAM。
** 「nvmem」是NVRAM與系統記憶體的混合體。
** 「AS」是未連接至磁碟櫃的序列連接SCSI裝置。


. 視需要執行診斷。
+
[cols="1,2"]
|===
| 如果您要在...上執行診斷測試 | 然後... 


 a| 
個別元件
 a| 
.. 清除狀態記錄：「ldiag」裝置的清除狀態
.. 顯示所選裝置的可用測試：「ldiag」裝置顯示-dev_dev_name_
+
「DEEV_NAME」可以是前述步驟所識別的任何一個連接埠和裝置。

.. 檢查輸出、如果適用、請僅選取您要執行的測試：「ldiag設備modify -dev_name_-selection only」（僅限ldiag設備修改-dev_dev_name_選擇）
+
「僅限選取」會停用您不想為裝置執行的所有其他測試。

.. 執行選取的測試：「ldiag裝置執行-dev_name_」
+
測試完成後、會顯示下列訊息：

+
[listing]
----
*> <SLDIAG:_ALL_TESTS_COMPLETED>
----
.. 確認沒有測試失敗：「ldiag設備狀態-dev_dev_name_-long -stStatus fAILED」
+
如果沒有測試失敗、系統層級的診斷會返回提示、或列出測試元件所導致的故障完整狀態。





 a| 
同時提供多個元件
 a| 
.. 檢閱上述程序輸出中已啟用和已停用的裝置、並判斷您要同時執行的裝置。
.. 列出裝置的個別測試：「ldiag設備show -dev_name_」
.. 檢查輸出、如果適用、請僅選取您要執行的測試：「ldiag設備modify -dev_name_-selection only」（僅限ldiag設備修改-dev_dev_name_選擇）
+
「僅限選取」會停用您不想為裝置執行的所有其他測試。

.. 驗證測試是否已修改：「ldiag device show」
.. 針對您要同時執行的每個裝置重複這些子步驟。
.. 在所有裝置上執行診斷：「ldiag device run」（執行ldiag裝置）
+

NOTE: 開始執行診斷後、請勿新增或修改您的項目。

+
測試完成後、會顯示下列訊息：

+
[listing]
----
*> <SLDIAG:_ALL_TESTS_COMPLETED>
----
.. 驗證節點上是否存在硬體問題：「ldiag設備狀態-long -state f失敗」
+
如果沒有測試失敗、系統層級的診斷會返回提示、或列出測試元件所導致的故障完整狀態。



|===
. 根據上述步驟的結果繼續進行：
+
[cols="1,2"]
|===
| 如果系統層級的診斷測試... | 然後... 


 a| 
已完成、沒有任何故障
 a| 
.. 清除狀態記錄：「ldiag」裝置的清除狀態
.. 確認記錄已清除：「ldiag設備狀態」
+
畫面會顯示下列預設回應：

+
[listing]
----
SLDIAG: No log messages are present.
----
.. 退出維護模式：「halt」
+
節點會顯示載入程式提示。

.. 從載入程式提示字元「bye」開機節點
.. 使節點恢復正常運作：




 a| 
HA配對
 a| 
執行回饋：「儲存容錯移轉回傳-ofnode_replace_node_name_」


NOTE: 如果停用自動還原、請使用「儲存容錯移轉修改」命令重新啟用。



 a| 
雙節點MetroCluster 的不全功能組態
 a| 
繼續下一步。

更新程序的下一項工作是執行此程序。MetroCluster



 a| 
獨立組態
 a| 
繼續下一步。

無需採取任何行動。

您已完成系統層級的診斷。



 a| 
導致某些測試失敗
 a| 
判斷問題的原因：

.. 退出維護模式：「halt」
+
發出命令後、請等待系統在載入程式提示字元停止。

.. 根據機箱中的控制器模組數量、關閉或離開電源供應器：
+
*** 如果機箱中有兩個控制器模組、請讓電源供應器保持開啟狀態、以便為其他控制器模組提供電力。
*** 如果機箱中有一個控制器模組、請關閉電源供應器、然後從電源插座拔下它們。


.. 確認您已注意到執行系統層級診斷所需的所有考量事項、纜線是否穩固連接、以及硬體元件是否已正確安裝在儲存系統中。
.. 引導您正在維修的控制器模組、並在系統提示您進入「Boot（開機）」功能表時按「Ctrl-C」中斷開機：
+
*** 如果機箱中有兩個控制器模組、請將您要維修的控制器模組完全裝入機箱。
+
控制器模組完全就位時會開機。

*** 如果機箱中有一個控制器模組、請連接電源供應器、然後將其開啟。


.. 從功能表中選取開機至維護模式。
.. 輸入以下命令退出維護模式：「halt（停止）」
+
發出命令後、請等待系統在載入程式提示字元停止。

.. 重新執行系統層級的診斷測試。


|===

